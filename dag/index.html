
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../nodes/">
      
      
        <link rel="next" href="../DAGExecution/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.10">
    
    
      
        <title>DAG - tawazi</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tawazi.dag.DAG" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="tawazi" class="md-header__button md-logo" aria-label="tawazi" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tawazi
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DAG
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mindee/tawazi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mindee/tawazi
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="tawazi" class="md-nav__button md-logo" aria-label="tawazi" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    tawazi
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mindee/tawazi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mindee/tawazi
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        decorators
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nodes/" class="md-nav__link">
        ExecNodes
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          DAG
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        DAG
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG" class="md-nav__link">
    tawazi.dag.DAG
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.config_from_dict" class="md-nav__link">
    config_from_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.config_from_json" class="md-nav__link">
    config_from_json()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.config_from_yaml" class="md-nav__link">
    config_from_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.draw" class="md-nav__link">
    draw()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.executor" class="md-nav__link">
    executor()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.get_node_by_id" class="md-nav__link">
    get_node_by_id()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.get_nodes_by_tag" class="md-nav__link">
    get_nodes_by_tag()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.setup" class="md-nav__link">
    setup()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../DAGExecution/" class="md-nav__link">
        DAGExecution
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../future_developments/" class="md-nav__link">
        Future Developments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/mindee/tawazi/releases" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG" class="md-nav__link">
    tawazi.dag.DAG
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.config_from_dict" class="md-nav__link">
    config_from_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.config_from_json" class="md-nav__link">
    config_from_json()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.config_from_yaml" class="md-nav__link">
    config_from_yaml()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.draw" class="md-nav__link">
    draw()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.executor" class="md-nav__link">
    executor()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.get_node_by_id" class="md-nav__link">
    get_node_by_id()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.get_nodes_by_tag" class="md-nav__link">
    get_nodes_by_tag()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.dag.DAG.setup" class="md-nav__link">
    setup()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



  <h1>DAG</h1>

<div class="doc doc-object doc-class">


<a id="tawazi.dag.DAG"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="typing.Generic">Generic</span>[<span title="tawazi.consts.P">P</span>, <span title="tawazi.consts.RVDAG">RVDAG</span>]</code></p>

  
      <p>Data Structure containing ExecNodes with interdependencies.</p>
<p>Please do not instantiate this class directly. Use the decorator <code>@dag</code> instead.</p>

<details class="the-execnodes-can-be-executed-in-parallel-with-the-following-restrictions">
  <summary>The ExecNodes can be executed in parallel with the following restrictions</summary>
  <ul>
<li>Limited number of threads.</li>
<li>Parallelization constraint of each ExecNode (is_sequential attribute)</li>
</ul>
</details>

        <details class="quote">
          <summary>Source code in <code>tawazi/dag.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">class</span> <span class="nc">DAG</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVDAG</span><span class="p">]):</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Data Structure containing ExecNodes with interdependencies.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Please do not instantiate this class directly. Use the decorator `@dag` instead.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    The ExecNodes can be executed in parallel with the following restrictions:</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        * Limited number of threads.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        * Parallelization constraint of each ExecNode (is_sequential attribute)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="n">exec_nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecNode</span><span class="p">],</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="n">max_concurrency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">behavior</span><span class="p">:</span> <span class="n">ErrorStrategy</span> <span class="o">=</span> <span class="n">ErrorStrategy</span><span class="o">.</span><span class="n">strict</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor of the DAG. Should not be called directly. Instead use the `dag` decorator.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            exec_nodes: all the ExecNodes</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            max_concurrency: the maximal number of threads running in parallel</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            behavior: specify the behavior if an ExecNode raises an Error. Three option are currently supported:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">                1. DAG.STRICT: stop the execution of all the DAG</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                2. DAG.ALL_CHILDREN: do not execute all children ExecNodes, and continue execution of the DAG</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                2. DAG.PERMISSIVE: continue execution of the DAG and ignore the error</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span> <span class="o">=</span> <span class="n">DiGraphEx</span><span class="p">()</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="c1"># ExecNodes can be shared between Graphs, their call signatures might also be different</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="c1"># NOTE: maybe this should be transformed into a property because there is a deepcopy for node_dict...</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="c1">#  this means that there are different ExecNodes that are hanging arround in the same instance of the DAG</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span> <span class="o">=</span> <span class="n">exec_nodes</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrency</span> <span class="o">=</span> <span class="n">max_concurrency</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Identifier</span><span class="p">,</span> <span class="n">ExecNode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="n">exec_node</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">exec_node</span> <span class="k">for</span> <span class="n">exec_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="p">}</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="c1"># Compute all the tags in the DAG to reduce overhead during computation</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tagged_nodes</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">for</span> <span class="n">xn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="k">if</span> <span class="n">xn</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tagged_nodes</span><span class="p">[</span><span class="n">xn</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="c1"># Might be useful in the future</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_dict_by_name</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ExecNode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">exec_node</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="n">exec_node</span> <span class="k">for</span> <span class="n">exec_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="p">}</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="p">:</span> <span class="n">ReturnIDsType</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Identifier</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="c1"># a sequence of execution to be applied in a for loop</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exec_node_sequence</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecNode</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">behavior</span> <span class="o">=</span> <span class="n">behavior</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">()</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bckrd_deps</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="p">))</span> <span class="k">for</span> <span class="n">xn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="p">}</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frwrd_deps</span> <span class="o">=</span> <span class="p">{</span><span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="p">))</span> <span class="k">for</span> <span class="n">xn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span><span class="p">}</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="c1"># calculate the sum of priorities of all recursive children</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_compound_priority</span><span class="p">()</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="c1"># make a valid execution sequence to run sequentially if needed</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">topological_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="o">.</span><span class="n">topologically_sorted</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exec_node_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">xn_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">xn_id</span> <span class="ow">in</span> <span class="n">topological_order</span><span class="p">]</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">def</span> <span class="nf">max_concurrency</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maximal number of threads running in parallel. (will change!).&quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="nd">@max_concurrency</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">def</span> <span class="nf">max_concurrency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the maximal number of threads running in parallel.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">            value (int): maximum number of threads running in parallel</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            ValueError: if value is not a positive integer</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_concurrency must be an int&quot;</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid maximum number of threads! Must be a positive integer&quot;</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="c1"># getters</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">def</span> <span class="nf">get_nodes_by_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecNode</span><span class="p">]:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ExecNodes with the given tag.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Note: the returned ExecNode is not modified by any execution!</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">            This means that you can not get the result of its execution via `DAG.get_nodes_by_tag(&lt;tag&gt;).result`.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">            In order to do that, you need to make a DAGExecution and then call `DAGExecution.get_nodes_by_tag(&lt;tag&gt;).result`, which will contain the results.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">            tag (Any): tag of the ExecNodes</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">            List[ExecNode]: corresponding ExecNodes</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">ex_n</span> <span class="k">for</span> <span class="n">ex_n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span> <span class="k">if</span> <span class="n">ex_n</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">]</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">def</span> <span class="nf">get_node_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecNode</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ExecNode with the given id.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Note: the returned ExecNode is not modified by any execution!</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">            This means that you can not get the result of its execution via `DAG.get_node_by_id(&lt;id&gt;).result`.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            In order to do that, you need to make a DAGExecution and then call `DAGExecution.get_node_by_id(&lt;id&gt;).result`, which will contain the results.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            id_ (Identifier): id of the ExecNode</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">            ExecNode: corresponding ExecNode</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="c1"># TODO: ? catch the keyError and</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="c1">#   help the user know the id of the ExecNode by pointing to documentation!?</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="c1"># TODO: get node by usage (the order of call of an ExecNode)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="c1"># TODO: validate using Pydantic</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">def</span> <span class="nf">_find_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Finds the cycles in the DAG. A DAG shouldn&#39;t have any dependency cycle.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">            A list of the edges responsible for the cycles in case there are some (in forward and backward),</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">             otherwise nothing. (e.g. [(&#39;taxes&#39;, &#39;amount_reconciliation&#39;),(&#39;amount_reconciliation&#39;, &#39;taxes&#39;)])</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">cycle</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">find_cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="k">return</span> <span class="n">cycle</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="k">except</span> <span class="n">NetworkXNoCycle</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">def</span> <span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds the graph and the sequence order for the computation.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            NetworkXUnfeasible: if the graph has cycles</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="c1"># 1. Make the graph</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="c1"># 1.1 add nodes</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">for</span> <span class="n">xn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="c1"># 1.2 add edges</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="k">for</span> <span class="n">xn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">dep</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">xn</span><span class="o">.</span><span class="n">dependencies</span><span class="p">]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="c1"># 2. Validate the DAG: check for circular dependencies</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_cycle</span><span class="p">()</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="k">if</span> <span class="n">cycle</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="k">raise</span> <span class="n">NetworkXUnfeasible</span><span class="p">(</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                <span class="sa">f</span><span class="s2">&quot;the product contains at least a circular dependency: </span><span class="si">{</span><span class="n">cycle</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="c1"># validate setup ExecNodes</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">for</span> <span class="n">xn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="k">if</span> <span class="n">xn</span><span class="o">.</span><span class="n">setup</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">dep</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_ids</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">xn</span><span class="o">.</span><span class="n">dependencies</span><span class="p">):</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="k">raise</span> <span class="n">TawaziUsageError</span><span class="p">(</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                    <span class="sa">f</span><span class="s2">&quot;The ExecNode </span><span class="si">{</span><span class="n">xn</span><span class="si">}</span><span class="s2"> takes as parameters one of the DAG&#39;s input parameter&quot;</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="c1"># future validations...</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">def</span> <span class="nf">_assign_compound_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Assigns a compound priority to all nodes in the graph.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        The compound priority is the sum of the priorities of all children recursively.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="c1"># 1. deepcopy graph_ids because it will be modified (pruned)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="n">graph_ids</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">leaf_ids</span> <span class="o">=</span> <span class="n">graph_ids</span><span class="o">.</span><span class="n">leaf_nodes</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="c1"># 2. assign the compound priority for all the remaining nodes in the graph:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="c1"># Priority assignment happens by epochs:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="c1"># 2.1. during every epoch, we assign the compound priority for the parents of the current leaf nodes</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="c1"># 2.2. at the end of every epoch, we trim the graph from its leaf nodes;</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="c1">#       hence the previous parents become the new leaf nodes</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="c1"># Epoch level</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="k">for</span> <span class="n">leaf_id</span> <span class="ow">in</span> <span class="n">leaf_ids</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">leaf_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">leaf_id</span><span class="p">]</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="k">for</span> <span class="n">parent_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bckrd_deps</span><span class="p">[</span><span class="n">leaf_id</span><span class="p">]:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                    <span class="c1"># increment the compound_priority of the parent node by the leaf priority</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                    <span class="n">parent_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                    <span class="n">parent_node</span><span class="o">.</span><span class="n">compound_priority</span> <span class="o">+=</span> <span class="n">leaf_node</span><span class="o">.</span><span class="n">compound_priority</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                <span class="c1"># trim the graph from its leaf nodes</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="n">graph_ids</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">leaf_id</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="c1"># assign the new leaf nodes</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">leaf_ids</span> <span class="o">=</span> <span class="n">graph_ids</span><span class="o">.</span><span class="n">leaf_nodes</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Draws the Networkx directed graph.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">            k (float): parameter for the layout of the graph, the higher, the further the nodes apart. Defaults to 0.8.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">            display (bool): display the layout created. Defaults to True.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">            t (int): time to display in seconds. Defaults to 3.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="c1"># TODO: use graphviz instead! it is much more elegant</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42069</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">def</span> <span class="nf">_copy_non_setup_xns</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ExecNode</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ExecNode</span><span class="p">]:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deep copy all ExecNodes except setup ExecNodes because they are shared throughout the DAG instance.</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">            x_nodes: Dict[str, ExecNode] x_nodes to be deep copied</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">            Dict[str, ExecNode] copy of x_nodes</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="c1"># TODO: separate setup xnodes and non setup xndoes.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="c1">#  maybe use copy instead of deepcopy for the non setup xnodes!? I think this is a bad idea it won&#39;t work</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">x_nodes_copy</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">x_nd</span> <span class="ow">in</span> <span class="n">x_nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="c1"># if execnode is a setup node, it shouldn&#39;t be copied</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">if</span> <span class="n">x_nd</span><span class="o">.</span><span class="n">setup</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                <span class="n">x_nodes_copy</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_nd</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="c1"># no need to deepcopy. we only need to know if self.result is NoVal or not (TODO: fix this COmment)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="n">x_nodes_copy</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">x_nd</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="k">return</span> <span class="n">x_nodes_copy</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="n">graph</span><span class="p">:</span> <span class="n">DiGraphEx</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="n">modified_node_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ExecNode</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">call_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Identifier</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Thread safe execution of the DAG.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        (Except for the setup nodes! Please run DAG.setup() in a single thread because its results will be cached).</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">            graph: the graph ids to be executed</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">            modified_node_dict: A dictionary of the ExecNodes that have been modified by setting the input parameters of the DAG.</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">            call_id (str): A unique identifier for the execution.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">                It can be used to distinguish the id of the call inside the thread.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">                It might be useful to debug and to exchange information between the main thread and the sub-threads (per-node threads)</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">            node_dict: dictionary with keys the name of the function and value the result after the execution</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="c1"># 0.1 create a subgraph of the graph if necessary</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="c1"># 0.2 deepcopy the node_dict in order to modify the results inside every node and make the dag reusable</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="c1">#     modified_node_dict are used to modify the values inside the ExecNode corresponding</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="c1">#     to the input arguments provided to the whole DAG (ArgExecNode)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="n">xns_dict</span> <span class="o">=</span> <span class="n">modified_node_dict</span> <span class="ow">or</span> <span class="n">DAG</span><span class="o">.</span><span class="n">_copy_non_setup_xns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="c1"># 0.3 prune the graph from the ArgExecNodes so that they don&#39;t get executed in the ThreadPool</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">precomputed_xns_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">xns_dict</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span><span class="o">.</span><span class="n">executed</span><span class="p">]</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">precomputed_xns_ids</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="c1"># 0.4 create variables related to futures</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">futures</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Identifier</span><span class="p">,</span> <span class="s2">&quot;Future[Any]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="n">done</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="s2">&quot;Future[Any]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">running</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="s2">&quot;Future[Any]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="c1"># TODO: support non &quot;threadable&quot; ExecNodes.</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="c1">#  These are ExecNodes that can&#39;t run inside a thread because their arguments aren&#39;t pickelable!</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="c1"># 0.5 create helpers functions encapsulated from the outside</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="k">def</span> <span class="nf">get_num_running_threads</span><span class="p">(</span><span class="n">_futures</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Identifier</span><span class="p">,</span> <span class="s2">&quot;Future[Any]&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="c1"># use not future.done() because there is no guarantee that Thread pool will directly execute</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>            <span class="c1"># the submitted thread</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="ow">not</span> <span class="n">future</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">_futures</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="k">def</span> <span class="nf">get_highest_priority_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecNode</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecNode</span><span class="p">]:</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="n">highest_priority</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">priority</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">)</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="k">return</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="n">highest_priority</span><span class="p">]</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="c1"># 0.6 get the candidates root nodes that can be executed</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="c1"># runnable_nodes_ids will be empty if all root nodes are running</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">runnable_xns_ids</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">root_nodes</span><span class="p">()</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_concurrency</span><span class="p">,</span> <span class="n">thread_name_prefix</span><span class="o">=</span><span class="n">call_id</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="c1"># attempt to run **A SINGLE** root node #</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                <span class="c1"># 6. block scheduler execution if no root node can be executed.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="c1">#    this can occur in two cases:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                <span class="c1">#       1. if maximum concurrency is reached</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="c1">#       2. if no runnable node exists (i.e. all root nodes are being executed)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>                <span class="c1">#    in both cases: block until a node finishes</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="c1">#       =&gt; a new root node will be available</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                <span class="n">num_running_threads</span> <span class="o">=</span> <span class="n">get_num_running_threads</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="n">num_runnable_nodes_ids</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">runnable_xns_ids</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                <span class="k">if</span> <span class="n">num_running_threads</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrency</span> <span class="ow">or</span> <span class="n">num_runnable_nodes_ids</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                    <span class="c1"># must wait and not submit any workers before a worker ends</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                    <span class="c1"># (that might create a new more prioritized node) to be executed</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                        <span class="sa">f</span><span class="s2">&quot;Waiting for ExecNodes </span><span class="si">{</span><span class="n">running</span><span class="si">}</span><span class="s2"> to finish. Finished running </span><span class="si">{</span><span class="n">done</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                    <span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>                    <span class="n">done_</span><span class="p">,</span> <span class="n">running</span> <span class="o">=</span> <span class="n">wait</span><span class="p">(</span><span class="n">running</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                    <span class="n">done</span> <span class="o">=</span> <span class="n">done</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">done_</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>                <span class="c1"># 1. among the finished futures:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>                <span class="c1">#       1. checks for exceptions</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                <span class="c1">#       2. and remove them from the graph</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">futures</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>                    <span class="k">if</span> <span class="n">fut</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remove ExecNode </span><span class="si">{</span><span class="n">id_</span><span class="si">}</span><span class="s2"> from the graph&quot;</span><span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_exception</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">fut</span><span class="p">,</span> <span class="n">id_</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="c1"># 2. list the root nodes that aren&#39;t being executed</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="n">runnable_xns_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">root_nodes</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">futures</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="c1"># 3. if no runnable node exist, go to step 6 (wait for a node to finish)</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="c1">#   (This **might** create a new root node)</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runnable_xns_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No runnable Nodes available&quot;</span><span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="c1"># 4. choose a node to run</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>                <span class="c1"># 4.1 get the most prioritized node to run</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="c1"># 4.1.1 get all the nodes that have the highest priority</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="n">runnable_xns</span> <span class="o">=</span> <span class="p">[</span><span class="n">xns_dict</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">runnable_xns_ids</span><span class="p">]</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                <span class="n">highest_priority_xns</span> <span class="o">=</span> <span class="n">get_highest_priority_nodes</span><span class="p">(</span><span class="n">runnable_xns</span><span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                <span class="c1"># 4.1.2 get the node with the highest compound priority</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="c1"># (randomly selected if multiple are suggested)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                <span class="n">highest_priority_xns</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">compound_priority</span><span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="n">xn</span> <span class="o">=</span> <span class="n">highest_priority_xns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> will run!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="c1"># 4.2 if the current node must be run sequentially, wait for a running node to finish.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                <span class="c1"># in that case we must prune the graph to re-check whether a new root node</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                <span class="c1"># (maybe with a higher priority) has been created =&gt; continue the loop</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                <span class="c1"># Note: This step might run a number of times in the while loop</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>                <span class="c1">#       before the exec_node gets submitted</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                <span class="n">num_running_threads</span> <span class="o">=</span> <span class="n">get_num_running_threads</span><span class="p">(</span><span class="n">futures</span><span class="p">)</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                <span class="k">if</span> <span class="n">xn</span><span class="o">.</span><span class="n">is_sequential</span> <span class="ow">and</span> <span class="n">num_running_threads</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> must not run in parallel.&quot;</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                        <span class="sa">f</span><span class="s2">&quot;Wait for the end of a node in </span><span class="si">{</span><span class="n">running</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                    <span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                    <span class="n">done_</span><span class="p">,</span> <span class="n">running</span> <span class="o">=</span> <span class="n">wait</span><span class="p">(</span><span class="n">running</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                    <span class="c1"># go to step 6</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                <span class="c1"># 5.1 submit the exec node to the executor</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                <span class="c1"># TODO: make a special case if self.max_concurrency == 1</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                <span class="c1">#   then invoke the function directly instead of launching a thread</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="n">exec_future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">xn</span><span class="o">.</span><span class="n">_execute</span><span class="p">,</span> <span class="n">node_dict</span><span class="o">=</span><span class="n">xns_dict</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="n">running</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">exec_future</span><span class="p">)</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                <span class="n">futures</span><span class="p">[</span><span class="n">xn</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">exec_future</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                <span class="c1"># 5.2 wait for the sequential node to finish</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="c1"># TODO: not sure this code ever runs</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                <span class="k">if</span> <span class="n">xn</span><span class="o">.</span><span class="n">is_sequential</span><span class="p">:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>                    <span class="n">wait</span><span class="p">(</span><span class="n">futures</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">return_when</span><span class="o">=</span><span class="n">ALL_COMPLETED</span><span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="k">return</span> <span class="n">xns_dict</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="k">def</span> <span class="nf">_alias_to_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="n">Alias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Identifier</span><span class="p">]:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract an ExecNode ID from an Alias (Tag, ExecNode ID or ExecNode).</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">            alias (Alias): an Alias (Tag, ExecNode ID or ExecNode)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">            The corresponding ExecNode IDs</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">            ValueError: if a requested ExecNode is not found in the DAG</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">            TawaziTypeError: if the Type of the identifier is not Tag, Identifier or ExecNode</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">ExecNode</span><span class="p">):</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="k">return</span> <span class="p">[</span><span class="n">alias</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="c1"># todo: do further validation for the case of the tag!!</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="p">(</span><span class="n">Identifier</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="c1"># if leaves_identification is not ExecNode, it can be either</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="c1">#  1. a Tag (Highest priority in case an id with the same value exists)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="k">if</span> <span class="n">nodes</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagged_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alias</span><span class="p">):</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="k">return</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">]</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="c1">#  2. or a node id!</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">)</span> <span class="ow">and</span> <span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_by_id</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                <span class="k">return</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="sa">f</span><span class="s2">&quot;node or tag </span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2"> not found in DAG.</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="sa">f</span><span class="s2">&quot; Available nodes are </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="sa">f</span><span class="s2">&quot; Available tags are </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagged_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="p">)</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="k">raise</span> <span class="n">TawaziTypeError</span><span class="p">(</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="s2">&quot;target_nodes must be of type ExecNode, &quot;</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="sa">f</span><span class="s2">&quot;str or tuple identifying the node but provided </span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="p">)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="c1"># NOTE: this function is named wrongly!</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>    <span class="k">def</span> <span class="nf">_get_target_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Identifier</span><span class="p">]:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ids of ExecNodes corresponding to target_nodes.</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">            target_nodes (Optional[List[Alias]]): list of a ExecNode Aliases that the user might provide to run a subgraph</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">            List[Identifier]: Leaf ExecNodes&#39; Identities</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alias_to_ids</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">target_nodes</span><span class="p">)))</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="k">def</span> <span class="nf">_extend_leaves_ids_debug_xns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leaves_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Identifier</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Identifier</span><span class="p">]:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">new_debug_xn_discovered</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="k">while</span> <span class="n">new_debug_xn_discovered</span><span class="p">:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="n">new_debug_xn_discovered</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">leaves_ids</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="k">for</span> <span class="n">successor_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frwrd_deps</span><span class="p">[</span><span class="n">id_</span><span class="p">]:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                    <span class="n">is_successor_debug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">successor_id</span><span class="p">]</span><span class="o">.</span><span class="n">debug</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                    <span class="k">if</span> <span class="n">successor_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">leaves_ids</span> <span class="ow">and</span> <span class="n">is_successor_debug</span><span class="p">:</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                        <span class="c1"># a new debug XN has been discovered!</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                        <span class="n">new_debug_xn_discovered</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>                        <span class="n">preds_of_succs_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">xn_id</span> <span class="k">for</span> <span class="n">xn_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bckrd_deps</span><span class="p">[</span><span class="n">successor_id</span><span class="p">]]</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>                        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">preds_of_succs_ids</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">leaves_ids</span><span class="p">)):</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>                            <span class="c1"># this new XN can run by only running the current leaves_ids</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>                            <span class="n">leaves_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">successor_id</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="k">return</span> <span class="n">leaves_ids</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="n">target_nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">exclude_nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the setup ExecNodes for the DAG.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        If target_nodes are provided, run only the necessary setup ExecNodes, otherwise will run all setup ExecNodes.</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        NOTE: `DAG` arguments should not be passed to setup ExecNodes.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">            Only pass in constants or setup `ExecNode`s results.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">            target_nodes (Optional[List[XNId]], optional): The ExecNodes that the user aims to use in the DAG.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">                This might include setup or non setup ExecNodes. If None is provided, will run all setup ExecNodes. Defaults to None.</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">            exclude_nodes (Optional[List[XNId]], optional): The ExecNodes that the user aims to exclude from the DAG.</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">                The user is responsible for ensuring that the overlapping between the target_nodes and exclude_nodes is logical.</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="c1"># 1. select all setup ExecNodes</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="c1">#  do not copy the setup nodes because we want them to be modified per DAG instance!</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="n">all_setup_nodes</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="n">nd</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">nd</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="k">if</span> <span class="n">nd</span><span class="o">.</span><span class="n">setup</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nd</span><span class="p">,</span> <span class="n">ArgExecNode</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nd</span><span class="o">.</span><span class="n">executed</span><span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="p">}</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="c1"># 2. if target_nodes is not provided run all setup ExecNodes</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="k">if</span> <span class="n">target_nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="n">target_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_setup_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_subgraph</span><span class="p">(</span><span class="n">target_ids</span><span class="p">,</span> <span class="n">exclude_nodes</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>            <span class="c1"># 2.1 the leaves_ids that the user wants to execute</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="c1">#  however they might contain non setup nodes... so we should extract all the nodes ids</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="c1">#  that must be run in order to run the target_nodes ExecNodes</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="c1">#  afterwards we can remove the non setup nodes</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="n">target_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_ids</span><span class="p">(</span><span class="n">target_nodes</span><span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="c1"># 2.2 filter non setup ExecNodes</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_subgraph</span><span class="p">(</span><span class="n">target_ids</span><span class="p">,</span> <span class="n">exclude_nodes</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="n">ids_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">id_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_setup_nodes</span><span class="p">]</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids_to_remove</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="c1"># TODO: handle debug XNs!</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">all_setup_nodes</span><span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="k">def</span> <span class="nf">executor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DAGExecution[P, RVDAG]&quot;</span><span class="p">:</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a DAGExecution for the DAG.</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">            **kwargs (Any): keyword arguments to be passed to DAGExecution&#39;s constructor</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">            DAGExecution: an executor for the DAG</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="k">return</span> <span class="n">DAGExecution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="k">def</span> <span class="nf">_make_subgraph</span><span class="p">(</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="n">target_nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="n">exclude_nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">:</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="k">if</span> <span class="n">target_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="n">target_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_ids</span><span class="p">(</span><span class="n">target_nodes</span><span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="n">graph</span><span class="o">.</span><span class="n">subgraph_leaves</span><span class="p">(</span><span class="n">target_ids</span><span class="p">)</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="k">if</span> <span class="n">exclude_nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="n">exclude_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alias_to_ids</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">exclude_nodes</span><span class="p">)))</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">exclude_ids</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>                <span class="c1"># maybe previously removed by :</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>                <span class="c1"># 1. not being inside the subgraph</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>                <span class="c1"># 2. being a successor of an excluded node</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>                <span class="k">if</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>                    <span class="n">graph</span><span class="o">.</span><span class="n">remove_recursively</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="k">if</span> <span class="n">target_nodes</span> <span class="ow">and</span> <span class="n">exclude_nodes</span><span class="p">:</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">target_ids</span><span class="p">:</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                <span class="k">if</span> <span class="n">id_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>                    <span class="k">raise</span> <span class="n">TawaziUsageError</span><span class="p">(</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>                        <span class="sa">f</span><span class="s2">&quot;target_nodes include </span><span class="si">{</span><span class="n">id_</span><span class="si">}</span><span class="s2"> which is removed by exclude_nodes: </span><span class="si">{</span><span class="n">exclude_ids</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>                        <span class="sa">f</span><span class="s2">&quot;please verify that they don&#39;t overlap in a non logical way!&quot;</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                    <span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="c1"># handle debug nodes</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="k">if</span> <span class="n">Cfg</span><span class="o">.</span><span class="n">RUN_DEBUG_NODES</span><span class="p">:</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="n">leaves_ids</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">leaf_nodes</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="c1"># after extending leaves_ids, we should do a recheck because this might recreate another debug-able XN...</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="n">target_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extend_leaves_ids_debug_xns</span><span class="p">(</span><span class="n">leaves_ids</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="c1"># extend the graph with the debug XNs</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="c1"># This is not efficient but it is ok since we are debugging the code anyways</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="n">debug_graph</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="n">debug_graph</span><span class="o">.</span><span class="n">subgraph_leaves</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">+</span> <span class="n">target_ids</span><span class="p">)</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="n">graph</span> <span class="o">=</span> <span class="n">debug_graph</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="c1"># 3. clean all debug XNs if they shouldn&#39;t run!</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">graph</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span><span class="o">.</span><span class="n">debug</span><span class="p">]</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                <span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="k">return</span> <span class="n">graph</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RVDAG</span><span class="p">:</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the DAG scheduler via a similar interface to the function that describes the dependencies.</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        Note: Currently kwargs are not supported.</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">            They will supported soon!</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">            *args (P.args): arguments to be passed to the call of the DAG</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">            **kwargs (P.kwargs): keyword arguments to be passed to the call of the DAG</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">            RVDAG: return value of the DAG&#39;s execution</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">            TawaziUsageError: kwargs are passed</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="k">raise</span> <span class="n">TawaziUsageError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;currently DAG does not support keyword arguments: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="c1"># 1. generate the subgraph to be executed</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_subgraph</span><span class="p">()</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="c1"># 2. copy the ExecNodes</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="n">call_xn_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_call_xn_dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="c1"># 3. Execute the scheduler</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="n">all_nodes_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">call_xn_dict</span><span class="p">)</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="c1"># 4. extract the returned value/values</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_return_values</span><span class="p">(</span><span class="n">all_nodes_dict</span><span class="p">)</span>  <span class="c1"># type: ignore[return-value]</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="k">def</span> <span class="nf">_make_call_xn_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Identifier</span><span class="p">,</span> <span class="n">ExecNode</span><span class="p">]:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the calling ExecNode dict.</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">        This is a dict containing ExecNodes that will be executed (hence modified) by the DAG scheduler.</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">        This takes into consideration:</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="sd">         1. deep copying the ExecNodes</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">         2. filling the arguments of the call</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">         3. skipping the copy for setup ExecNodes</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">            *args (Any): arguments to be passed to the call of the DAG</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">            Dict[Identifier, ExecNode]: The modified ExecNode dict which will be executed by the DAG scheduler.</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">            TypeError: If called with an invalid number of arguments</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="c1"># 1. deepcopy the node_dict because it will be modified by the DAG&#39;s execution</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="n">call_xn_dict</span> <span class="o">=</span> <span class="n">DAG</span><span class="o">.</span><span class="n">_copy_non_setup_xns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">)</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="c1"># 2. parse the input arguments of the pipeline</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="c1"># 2.1 default valued arguments can be skipped and not provided!</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="c1"># note: if not enough arguments are provided then the code will fail</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="c1"># inside the DAG&#39;s execution through the raise_err lambda</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="c1"># 2.2 can&#39;t provide more than enough arguments</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_ids</span><span class="p">):</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                    <span class="sa">f</span><span class="s2">&quot;The DAG takes a maximum of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> arguments. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2"> arguments provided&quot;</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                <span class="p">)</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>            <span class="c1"># 2.3 modify ExecNodes corresponding to input ArgExecNodes</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>            <span class="k">for</span> <span class="n">ind_arg</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>                <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_ids</span><span class="p">[</span><span class="n">ind_arg</span><span class="p">]</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>                <span class="n">call_xn_dict</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">arg</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="k">return</span> <span class="n">call_xn_dict</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="k">def</span> <span class="nf">_get_return_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xn_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Identifier</span><span class="p">,</span> <span class="n">ExecNode</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">RVTypes</span><span class="p">:</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the return value/values from the output of the DAG&#39;s scheduler!</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">            xn_dict (Dict[Identifier, ExecNode]): Modified ExecNodes returned by the DAG&#39;s scheduler</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="sd">            TawaziTypeError: if the type of the return value is not compatible with RVTypes</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">            RVTypes: the actual values extracted from xn_dict</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="p">,</span> <span class="n">Identifier</span><span class="p">):</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>            <span class="k">return</span> <span class="n">_filter_noval</span><span class="p">(</span><span class="n">xn_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="p">]</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="n">gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">_filter_noval</span><span class="p">(</span><span class="n">xn_dict</span><span class="p">[</span><span class="n">ren_id</span><span class="p">]</span><span class="o">.</span><span class="n">result</span><span class="p">)</span> <span class="k">for</span> <span class="n">ren_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="p">)</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>            <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                <span class="n">key</span><span class="p">:</span> <span class="n">_filter_noval</span><span class="p">(</span><span class="n">xn_dict</span><span class="p">[</span><span class="n">ren_id</span><span class="p">]</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">ren_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_ids</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>            <span class="p">}</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="k">raise</span> <span class="n">TawaziTypeError</span><span class="p">(</span><span class="s2">&quot;Return type for the DAG can only be a single value, Tuple or List&quot;</span><span class="p">)</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="c1"># NOTE: this function should be used in case there was a bizarre behavior noticed during</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="c1">#   the execution of the DAG via DAG.execute(...)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="k">def</span> <span class="nf">_safe_execute</span><span class="p">(</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>        <span class="n">target_nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>        <span class="n">exclude_nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the ExecNodes in topological order without priority in for loop manner for debugging purposes.</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">            *args (Any): Positional arguments passed to the DAG</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">            target_nodes (Optional[List[Alias]]): the ExecNodes that should be considered to construct the subgraph</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">            exclude_nodes (Optional[List[Alias]]): the ExecNodes that shouldn&#39;t run</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">            Any: the result of the execution of the DAG.</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">             If an ExecNode returns a value in the DAG but is not executed, it will return None.</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="c1"># 1. make the graph_ids to be executed!</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_subgraph</span><span class="p">(</span><span class="n">target_nodes</span><span class="p">,</span> <span class="n">exclude_nodes</span><span class="p">)</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="c1"># 2. make call_xn_dict that will be modified</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="n">call_xn_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_call_xn_dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>        <span class="c1"># 3. deep copy the node_dict to store the results in each node</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="k">for</span> <span class="n">xn_id</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">topologically_sorted</span><span class="p">:</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="c1"># only execute ExecNodes that are part of the subgraph</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="n">call_xn_dict</span><span class="p">[</span><span class="n">xn_id</span><span class="p">]</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">call_xn_dict</span><span class="p">)</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="c1"># 4. make returned values</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_return_values</span><span class="p">(</span><span class="n">call_xn_dict</span><span class="p">)</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="k">def</span> <span class="nf">_handle_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">DiGraphEx</span><span class="p">,</span> <span class="n">fut</span><span class="p">:</span> <span class="s2">&quot;Future[Any]&quot;</span><span class="p">,</span> <span class="n">id_</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if futures have produced exceptions, and handles them according to the specified behavior.</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">            graph: the graph</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">            fut: the thread future</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">            id_: the Identifier of the current ExecNode</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">            NotImplementedError: if self.behavior is not known</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">behavior</span> <span class="o">==</span> <span class="n">ErrorStrategy</span><span class="o">.</span><span class="n">strict</span><span class="p">:</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="c1"># will raise the first encountered exception if there&#39;s one</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="c1"># no simpler way to check for exception, and not supported by flake8</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>            <span class="n">_res</span> <span class="o">=</span> <span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c1"># noqa: F841</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                <span class="n">_res</span> <span class="o">=</span> <span class="n">fut</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c1"># noqa: F841</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The feature </span><span class="si">{</span><span class="n">id_</span><span class="si">}</span><span class="s2"> encountered the following error:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">behavior</span> <span class="o">==</span> <span class="n">ErrorStrategy</span><span class="o">.</span><span class="n">permissive</span><span class="p">:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Ignoring exception as the behavior is set to permissive&quot;</span><span class="p">)</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">behavior</span> <span class="o">==</span> <span class="n">ErrorStrategy</span><span class="o">.</span><span class="n">all_children</span><span class="p">:</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                    <span class="c1"># remove all its children. Current node will be removed directly afterwards</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                    <span class="n">successors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">id_</span><span class="p">))</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                    <span class="k">for</span> <span class="n">children_ids</span> <span class="ow">in</span> <span class="n">successors</span><span class="p">:</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>                        <span class="c1"># TODO: implement a test for all_children! it should fail!</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                        <span class="c1"># Afterwards include parameter to remove the node itself or not</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">remove_recursively</span><span class="p">(</span><span class="n">children_ids</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown behavior name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">behavior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="k">def</span> <span class="nf">config_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Allows reconfiguring the parameters of the nodes from a dictionary.</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">            config (Dict[str, Any]): the dictionary containing the config</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">                example: {&quot;nodes&quot;: {&quot;a&quot;: {&quot;priority&quot;: 3, &quot;is_sequential&quot;: True}}, &quot;max_concurrency&quot;: 3}</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">            ValueError: if two nodes are configured by the provided config (which is ambiguous)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="k">def</span> <span class="nf">_override_node_config</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">ExecNode</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>            <span class="k">if</span> <span class="s2">&quot;is_sequential&quot;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>                <span class="n">n</span><span class="o">.</span><span class="n">is_sequential</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;is_sequential&quot;</span><span class="p">]</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>            <span class="k">if</span> <span class="s2">&quot;priority&quot;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>                <span class="n">n</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>                <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="n">prio_flag</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>        <span class="n">visited</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="k">if</span> <span class="s2">&quot;nodes&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">conf_node</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>                <span class="n">ids_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alias_to_ids</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">ids_</span><span class="p">:</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                    <span class="k">if</span> <span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_by_id</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                        <span class="n">node_prio_flag</span> <span class="o">=</span> <span class="n">_override_node_config</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">conf_node</span><span class="p">)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                        <span class="n">prio_flag</span> <span class="o">=</span> <span class="n">node_prio_flag</span> <span class="ow">or</span> <span class="n">prio_flag</span>  <span class="c1"># keep track of flag</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                            <span class="sa">f</span><span class="s2">&quot;trying to set two configs for node </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2"> 1) </span><span class="si">{</span><span class="n">visited</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2"> 2) </span><span class="si">{</span><span class="n">conf_node</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>                        <span class="p">)</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                    <span class="n">visited</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf_node</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>        <span class="k">if</span> <span class="s2">&quot;max_concurrency&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrency</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="k">if</span> <span class="n">prio_flag</span><span class="p">:</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="c1"># if we changed the priority of some nodes we need to recompute the compound prio</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_compound_priority</span><span class="p">()</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="k">def</span> <span class="nf">config_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Allows reconfiguring the parameters of the nodes from a YAML file.</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">            config_path: the path to the YAML file</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>            <span class="n">yaml_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">_UniqueKeyLoader</span><span class="p">)</span>  <span class="c1"># noqa: S506</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_from_dict</span><span class="p">(</span><span class="n">yaml_config</span><span class="p">)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="k">def</span> <span class="nf">config_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Allows reconfiguring the parameters of the nodes from a JSON file.</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">            config_path: the path to the JSON file</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="n">json_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_from_dict</span><span class="p">(</span><span class="n">json_config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.__call__" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Execute the DAG scheduler via a similar interface to the function that describes the dependencies.</p>

<details class="note">
  <summary>Currently kwargs are not supported.</summary>
  <p>They will supported soon!</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>*args</code></td>
          <td>
                <code><span title="tawazi.consts.P">P</span>.<span title="tawazi.consts.P.args">args</span></code>
          </td>
          <td><p>arguments to be passed to the call of the DAG</p></td>
          <td>
                <code>()</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
                <code><span title="tawazi.consts.P">P</span>.<span title="tawazi.consts.P.kwargs">kwargs</span></code>
          </td>
          <td><p>keyword arguments to be passed to the call of the DAG</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>RVDAG</code></td>          <td>
                <code><span title="tawazi.consts.RVDAG">RVDAG</span></code>
          </td>
          <td><p>return value of the DAG's execution</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="tawazi.errors.TawaziUsageError">TawaziUsageError</span></code>
          </td>
          <td><p>kwargs are passed</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RVDAG</span><span class="p">:</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the DAG scheduler via a similar interface to the function that describes the dependencies.</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    Note: Currently kwargs are not supported.</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        They will supported soon!</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">        *args (P.args): arguments to be passed to the call of the DAG</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">        **kwargs (P.kwargs): keyword arguments to be passed to the call of the DAG</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">        RVDAG: return value of the DAG&#39;s execution</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">        TawaziUsageError: kwargs are passed</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="k">raise</span> <span class="n">TawaziUsageError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;currently DAG does not support keyword arguments: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="c1"># 1. generate the subgraph to be executed</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_subgraph</span><span class="p">()</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="c1"># 2. copy the ExecNodes</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="n">call_xn_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_call_xn_dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="c1"># 3. Execute the scheduler</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="n">all_nodes_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">call_xn_dict</span><span class="p">)</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="c1"># 4. extract the returned value/values</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_return_values</span><span class="p">(</span><span class="n">all_nodes_dict</span><span class="p">)</span>  <span class="c1"># type: ignore[return-value]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.config_from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_from_dict</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.config_from_dict" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Allows reconfiguring the parameters of the nodes from a dictionary.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>the dictionary containing the config
example: {"nodes": {"a": {"priority": 3, "is_sequential": True}}, "max_concurrency": 3}</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td><p>if two nodes are configured by the provided config (which is ambiguous)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="k">def</span> <span class="nf">config_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Allows reconfiguring the parameters of the nodes from a dictionary.</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">        config (Dict[str, Any]): the dictionary containing the config</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">            example: {&quot;nodes&quot;: {&quot;a&quot;: {&quot;priority&quot;: 3, &quot;is_sequential&quot;: True}}, &quot;max_concurrency&quot;: 3}</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">        ValueError: if two nodes are configured by the provided config (which is ambiguous)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="k">def</span> <span class="nf">_override_node_config</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">ExecNode</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="k">if</span> <span class="s2">&quot;is_sequential&quot;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>            <span class="n">n</span><span class="o">.</span><span class="n">is_sequential</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;is_sequential&quot;</span><span class="p">]</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="k">if</span> <span class="s2">&quot;priority&quot;</span> <span class="ow">in</span> <span class="n">cfg</span><span class="p">:</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>            <span class="n">n</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>    <span class="n">prio_flag</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>    <span class="n">visited</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>    <span class="k">if</span> <span class="s2">&quot;nodes&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>        <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">conf_node</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>            <span class="n">ids_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alias_to_ids</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>            <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">ids_</span><span class="p">:</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>                <span class="k">if</span> <span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_by_id</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                    <span class="n">node_prio_flag</span> <span class="o">=</span> <span class="n">_override_node_config</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">conf_node</span><span class="p">)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>                    <span class="n">prio_flag</span> <span class="o">=</span> <span class="n">node_prio_flag</span> <span class="ow">or</span> <span class="n">prio_flag</span>  <span class="c1"># keep track of flag</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>                        <span class="sa">f</span><span class="s2">&quot;trying to set two configs for node </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2"> 1) </span><span class="si">{</span><span class="n">visited</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2"> 2) </span><span class="si">{</span><span class="n">conf_node</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>                    <span class="p">)</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                <span class="n">visited</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf_node</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>    <span class="k">if</span> <span class="s2">&quot;max_concurrency&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_concurrency</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;max_concurrency&quot;</span><span class="p">]</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>    <span class="k">if</span> <span class="n">prio_flag</span><span class="p">:</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="c1"># if we changed the priority of some nodes we need to recompute the compound prio</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_compound_priority</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.config_from_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_from_json</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.config_from_json" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Allows reconfiguring the parameters of the nodes from a JSON file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the path to the JSON file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="k">def</span> <span class="nf">config_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Allows reconfiguring the parameters of the nodes from a JSON file.</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">        config_path: the path to the JSON file</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="n">json_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">config_from_dict</span><span class="p">(</span><span class="n">json_config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.config_from_yaml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_from_yaml</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.config_from_yaml" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Allows reconfiguring the parameters of the nodes from a YAML file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the path to the YAML file</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="k">def</span> <span class="nf">config_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Allows reconfiguring the parameters of the nodes from a YAML file.</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">        config_path: the path to the YAML file</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>        <span class="n">yaml_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">_UniqueKeyLoader</span><span class="p">)</span>  <span class="c1"># noqa: S506</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">config_from_dict</span><span class="p">(</span><span class="n">yaml_config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.draw" class="doc doc-heading">
<code class="highlight language-python"><span class="n">draw</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.draw" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Draws the Networkx directed graph.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>k</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>parameter for the layout of the graph, the higher, the further the nodes apart. Defaults to 0.8.</p></td>
          <td>
                <code>0.8</code>
          </td>
        </tr>
        <tr>
          <td><code>display</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>display the layout created. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>t</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>time to display in seconds. Defaults to 3.</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Draws the Networkx directed graph.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        k (float): parameter for the layout of the graph, the higher, the further the nodes apart. Defaults to 0.8.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        display (bool): display the layout created. Defaults to True.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        t (int): time to display in seconds. Defaults to 3.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="c1"># TODO: use graphviz instead! it is much more elegant</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42069</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_ids</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.executor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">executor</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.executor" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generates a DAGExecution for the DAG.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>keyword arguments to be passed to DAGExecution's constructor</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>DAGExecution</code></td>          <td>
                <code>DAGExecution[P, RVDAG]</code>
          </td>
          <td><p>an executor for the DAG</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="k">def</span> <span class="nf">executor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DAGExecution[P, RVDAG]&quot;</span><span class="p">:</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a DAGExecution for the DAG.</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        **kwargs (Any): keyword arguments to be passed to DAGExecution&#39;s constructor</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        DAGExecution: an executor for the DAG</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="k">return</span> <span class="n">DAGExecution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.get_node_by_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_node_by_id</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.get_node_by_id" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Get the ExecNode with the given id.</p>

<details class="note">
  <summary>the returned ExecNode is not modified by any execution!</summary>
  <p>This means that you can not get the result of its execution via <code>DAG.get_node_by_id(&lt;id&gt;).result</code>.
In order to do that, you need to make a DAGExecution and then call <code>DAGExecution.get_node_by_id(&lt;id&gt;).result</code>, which will contain the results.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>id_</code></td>
          <td>
                <code><span title="tawazi.consts.Identifier">Identifier</span></code>
          </td>
          <td><p>id of the ExecNode</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ExecNode</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="tawazi.node.ExecNode" href="../nodes/#tawazi.node.ExecNode">ExecNode</a></code>
          </td>
          <td><p>corresponding ExecNode</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="k">def</span> <span class="nf">get_node_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_</span><span class="p">:</span> <span class="n">Identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecNode</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the ExecNode with the given id.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    Note: the returned ExecNode is not modified by any execution!</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        This means that you can not get the result of its execution via `DAG.get_node_by_id(&lt;id&gt;).result`.</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        In order to do that, you need to make a DAGExecution and then call `DAGExecution.get_node_by_id(&lt;id&gt;).result`, which will contain the results.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        id_ (Identifier): id of the ExecNode</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        ExecNode: corresponding ExecNode</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="c1"># TODO: ? catch the keyError and</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="c1">#   help the user know the id of the ExecNode by pointing to documentation!?</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_dict</span><span class="p">[</span><span class="n">id_</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.get_nodes_by_tag" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_nodes_by_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.get_nodes_by_tag" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Get the ExecNodes with the given tag.</p>

<details class="note">
  <summary>the returned ExecNode is not modified by any execution!</summary>
  <p>This means that you can not get the result of its execution via <code>DAG.get_nodes_by_tag(&lt;tag&gt;).result</code>.
In order to do that, you need to make a DAGExecution and then call <code>DAGExecution.get_nodes_by_tag(&lt;tag&gt;).result</code>, which will contain the results.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>tag</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>tag of the ExecNodes</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="tawazi.node.ExecNode" href="../nodes/#tawazi.node.ExecNode">ExecNode</a>]</code>
          </td>
          <td><p>List[ExecNode]: corresponding ExecNodes</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="k">def</span> <span class="nf">get_nodes_by_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecNode</span><span class="p">]:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the ExecNodes with the given tag.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Note: the returned ExecNode is not modified by any execution!</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        This means that you can not get the result of its execution via `DAG.get_nodes_by_tag(&lt;tag&gt;).result`.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        In order to do that, you need to make a DAGExecution and then call `DAGExecution.get_nodes_by_tag(&lt;tag&gt;).result`, which will contain the results.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        tag (Any): tag of the ExecNodes</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        List[ExecNode]: corresponding ExecNodes</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">ex_n</span> <span class="k">for</span> <span class="n">ex_n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span> <span class="k">if</span> <span class="n">ex_n</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.dag.DAG.setup" class="doc doc-heading">
<code class="highlight language-python"><span class="n">setup</span><span class="p">(</span><span class="n">target_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tawazi.dag.DAG.setup" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Run the setup ExecNodes for the DAG.</p>
<p>If target_nodes are provided, run only the necessary setup ExecNodes, otherwise will run all setup ExecNodes.</p>

<details class="note">
  <summary><code>DAG</code> arguments should not be passed to setup ExecNodes.</summary>
  <p>Only pass in constants or setup <code>ExecNode</code>s results.</p>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>target_nodes</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[XNId]]</code>
          </td>
          <td><p>The ExecNodes that the user aims to use in the DAG.
This might include setup or non setup ExecNodes. If None is provided, will run all setup ExecNodes. Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>exclude_nodes</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[XNId]]</code>
          </td>
          <td><p>The ExecNodes that the user aims to exclude from the DAG.
The user is responsible for ensuring that the overlapping between the target_nodes and exclude_nodes is logical.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/dag.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="n">target_nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">exclude_nodes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Alias</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the setup ExecNodes for the DAG.</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">    If target_nodes are provided, run only the necessary setup ExecNodes, otherwise will run all setup ExecNodes.</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    NOTE: `DAG` arguments should not be passed to setup ExecNodes.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">        Only pass in constants or setup `ExecNode`s results.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">        target_nodes (Optional[List[XNId]], optional): The ExecNodes that the user aims to use in the DAG.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">            This might include setup or non setup ExecNodes. If None is provided, will run all setup ExecNodes. Defaults to None.</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">        exclude_nodes (Optional[List[XNId]], optional): The ExecNodes that the user aims to exclude from the DAG.</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">            The user is responsible for ensuring that the overlapping between the target_nodes and exclude_nodes is logical.</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="c1"># 1. select all setup ExecNodes</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="c1">#  do not copy the setup nodes because we want them to be modified per DAG instance!</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="n">all_setup_nodes</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">nd</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">nd</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_nodes</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="k">if</span> <span class="n">nd</span><span class="o">.</span><span class="n">setup</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nd</span><span class="p">,</span> <span class="n">ArgExecNode</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nd</span><span class="o">.</span><span class="n">executed</span><span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="p">}</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="c1"># 2. if target_nodes is not provided run all setup ExecNodes</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="k">if</span> <span class="n">target_nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="n">target_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_setup_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_subgraph</span><span class="p">(</span><span class="n">target_ids</span><span class="p">,</span> <span class="n">exclude_nodes</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="c1"># 2.1 the leaves_ids that the user wants to execute</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="c1">#  however they might contain non setup nodes... so we should extract all the nodes ids</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="c1">#  that must be run in order to run the target_nodes ExecNodes</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="c1">#  afterwards we can remove the non setup nodes</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="n">target_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_target_ids</span><span class="p">(</span><span class="n">target_nodes</span><span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="c1"># 2.2 filter non setup ExecNodes</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_subgraph</span><span class="p">(</span><span class="n">target_ids</span><span class="p">,</span> <span class="n">exclude_nodes</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">ids_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">graph</span> <span class="k">if</span> <span class="n">id_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_setup_nodes</span><span class="p">]</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids_to_remove</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="c1"># TODO: handle debug XNs!</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">all_setup_nodes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6df46069.min.js"></script>
      
    
  </body>
</html>