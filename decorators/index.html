
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../home/">
      
      
        <link rel="next" href="../nodes/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.10">
    
    
      
        <title>decorators - tawazi</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tawazi.decorators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="tawazi" class="md-header__button md-logo" aria-label="tawazi" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tawazi
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              decorators
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mindee/tawazi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mindee/tawazi
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="tawazi" class="md-nav__button md-logo" aria-label="tawazi" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    tawazi
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mindee/tawazi" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mindee/tawazi
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../home/" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          decorators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        decorators
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tawazi.decorators" class="md-nav__link">
    tawazi.decorators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.decorators.xn" class="md-nav__link">
    xn()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.decorators.dag" class="md-nav__link">
    dag()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nodes/" class="md-nav__link">
        ExecNodes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dag/" class="md-nav__link">
        DAG
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../DAGExecution/" class="md-nav__link">
        DAGExecution
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../future_developments/" class="md-nav__link">
        Future Developments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/mindee/tawazi/releases" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tawazi.decorators" class="md-nav__link">
    tawazi.decorators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.decorators.xn" class="md-nav__link">
    xn()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tawazi.decorators.dag" class="md-nav__link">
    dag()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



  <h1>decorators</h1>

<div class="doc doc-object doc-module">


<a id="tawazi.decorators"></a>
  <div class="doc doc-contents first">
  
      <p>Decorators of Tawazi.</p>
<p>The user should use the decorators <code>@dag</code> and <code>@xn</code> to create Tawazi objects <code>DAG</code> and <code>ExecNode</code>.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="tawazi.decorators.xn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">xn</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">is_sequential</span><span class="o">=</span><span class="n">Cfg</span><span class="o">.</span><span class="n">TAWAZI_IS_SEQUENTIAL</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tawazi.decorators.xn" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Decorate a normal function to make it an ExecNode.</p>
<p>When the decorated function is called inside a <code>DAG</code>, you are actually calling an <code>ExecNode</code>.
This way we can record the dependencies in order to build the actual DAG.
Please check the example in the README for a guide to the usage.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>func</code></td>
          <td>
                <code>[Callable[P, RVXN]</code>
          </td>
          <td><p>a Callable that will be executed in the <code>DAG</code></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>priority</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>priority of the execution with respect to other <code>ExecNode</code>s</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>is_sequential</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to allow the execution of this <code>ExecNode</code> with others or not.
If <code>True</code>, all other <code>ExecNode</code> currently running will stop before this one starts executing.</p></td>
          <td>
                <code>Cfg.TAWAZI_IS_SEQUENTIAL</code>
          </td>
        </tr>
        <tr>
          <td><code>debug</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if <code>True</code>, will execute only when Debug mode is active.
a debug <code>ExecNode</code> will run its inputs exists regardless of subgraph choice.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>tag</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>Any Hashable / immutable typed variable can be used to identify nodes (str, Tuples, int etc.).
It is the responsibility of the user to provide this immutability of the tag.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>setup</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, will be executed only once during the lifetime of a <code>DAG</code> instance.
Setup <code>ExecNode</code>s are meant to be used to load heavy data only once inside the execution pipeline
and then be used as if the results of their execution were cached.
This can be useful if you want to load heavy ML models, heavy Data etc.
Note that you can run all / subset of the setup nodes by invoking the DAG.setup method
NOTE setup nodes are currently not threadsafe!
    because they are shared between all threads!
    If you execute the same pipeline in multiple threads during the setup phase, the behavior is undefined.
    This is why it is best to invoke the DAG.setup method before using the DAG in a multithreaded environment.
    This problem will be resolved in the future</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>LazyExecNode</code></td>          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.Callable">Callable</span>[[<span title="typing.Callable">Callable</span>[<span title="tawazi.consts.P">P</span>, <span title="tawazi.consts.RVXN">RVXN</span>]], <span title="tawazi.node.LazyExecNode">LazyExecNode</span>[<span title="tawazi.consts.P">P</span>, <span title="tawazi.consts.RVXN">RVXN</span>]], <span title="tawazi.node.LazyExecNode">LazyExecNode</span>[<span title="tawazi.consts.P">P</span>, <span title="tawazi.consts.RVXN">RVXN</span>]]</code>
          </td>
          <td><p>The decorated function wrapped in an <code>ExecNode</code>.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>TypeError</code>
          </td>
          <td><p>If the decorated function passed is not a <code>Callable</code>.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/decorators.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="k">def</span> <span class="nf">xn</span><span class="p">(</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVXN</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">is_sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Cfg</span><span class="o">.</span><span class="n">TAWAZI_IS_SEQUENTIAL</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">tag</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">setup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVXN</span><span class="p">]],</span> <span class="n">LazyExecNode</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVXN</span><span class="p">]],</span> <span class="n">LazyExecNode</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVXN</span><span class="p">]]:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorate a normal function to make it an ExecNode.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    When the decorated function is called inside a `DAG`, you are actually calling an `ExecNode`.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    This way we can record the dependencies in order to build the actual DAG.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Please check the example in the README for a guide to the usage.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        func ([Callable[P, RVXN]): a Callable that will be executed in the `DAG`</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        priority (int): priority of the execution with respect to other `ExecNode`s</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        is_sequential (bool): whether to allow the execution of this `ExecNode` with others or not.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            If `True`, all other `ExecNode` currently running will stop before this one starts executing.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        debug (bool): if `True`, will execute only when Debug mode is active.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            a debug `ExecNode` will run its inputs exists regardless of subgraph choice.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        tag (Any): Any Hashable / immutable typed variable can be used to identify nodes (str, Tuples, int etc.).</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            It is the responsibility of the user to provide this immutability of the tag.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        setup (bool): if True, will be executed only once during the lifetime of a `DAG` instance.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            Setup `ExecNode`s are meant to be used to load heavy data only once inside the execution pipeline</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            and then be used as if the results of their execution were cached.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            This can be useful if you want to load heavy ML models, heavy Data etc.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            Note that you can run all / subset of the setup nodes by invoking the DAG.setup method</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            NOTE setup nodes are currently not threadsafe!</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">                because they are shared between all threads!</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                If you execute the same pipeline in multiple threads during the setup phase, the behavior is undefined.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">                This is why it is best to invoke the DAG.setup method before using the DAG in a multithreaded environment.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                This problem will be resolved in the future</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        LazyExecNode: The decorated function wrapped in an `ExecNode`.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        TypeError: If the decorated function passed is not a `Callable`.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">def</span> <span class="nf">intermediate_wrapper</span><span class="p">(</span><span class="n">_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVXN</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">LazyExecNode</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVXN</span><span class="p">]:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">lazy_exec_node</span> <span class="o">=</span> <span class="n">LazyExecNode</span><span class="p">(</span><span class="n">_func</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">is_sequential</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">setup</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">lazy_exec_node</span><span class="p">,</span> <span class="n">_func</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">return</span> <span class="n">lazy_exec_node</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="c1"># case #1: arguments are provided to the decorator</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">return</span> <span class="n">intermediate_wrapper</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="c1"># case #2: no argument is provided to the decorator</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> is not a callable. Did you use a non-keyword argument?&quot;</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">return</span> <span class="n">intermediate_wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="tawazi.decorators.dag" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dag</span><span class="p">(</span><span class="n">declare_dag_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_concurrency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">behavior</span><span class="o">=</span><span class="n">ErrorStrategy</span><span class="o">.</span><span class="n">strict</span><span class="p">)</span></code>

<a href="#tawazi.decorators.dag" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Transform the declared <code>ExecNode</code>s into a DAG that can be executed by Tawazi's scheduler.</p>
<p>The same DAG can be executed multiple times.</p>

<details class="note">
  <summary>dag is thread safe because it uses an internal lock.</summary>
  <p>If you need to construct lots of DAGs in multiple threads,
it is best to construct your dag once and then use it as much as you like.</p>
</details>      <p>Please check the example in the README for a guide to the usage.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>declare_dag_function</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[<span title="tawazi.consts.P">P</span>, <span title="tawazi.consts.RVDAG">RVDAG</span>]]</code>
          </td>
          <td><p>a function that describes the execution of the DAG.
This function should only contain calls to <code>ExecNode</code>s and data Exchange between them.
(i.e. You can not use a normal Python function inside it unless decorated with <code>@xn</code>.)
However, you can use some simple python code to generate constants.
These constants are computed only once during the <code>DAG</code> declaration.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_concurrency</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the maximum number of concurrent threads to execute in parallel.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>behavior</code></td>
          <td>
                <code><span title="tawazi.errors.ErrorStrategy">ErrorStrategy</span></code>
          </td>
          <td><p>the behavior of the <code>DAG</code> when an error occurs during the execution of a function (<code>ExecNode</code>).</p></td>
          <td>
                <code>ErrorStrategy.strict</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.Callable">Callable</span>[[<span title="typing.Callable">Callable</span>[<span title="tawazi.consts.P">P</span>, <span title="tawazi.consts.RVDAG">RVDAG</span>]], <a class="autorefs autorefs-internal" title="tawazi.dag.DAG" href="../dag/#tawazi.dag.DAG">DAG</a>[<span title="tawazi.consts.P">P</span>, <span title="tawazi.consts.RVDAG">RVDAG</span>]], <a class="autorefs autorefs-internal" title="tawazi.dag.DAG" href="../dag/#tawazi.dag.DAG">DAG</a>[<span title="tawazi.consts.P">P</span>, <span title="tawazi.consts.RVDAG">RVDAG</span>]]</code>
          </td>
          <td><p>a <code>DAG</code> instance that can be used just like a normal Python function. However it will be executed by Tawazi's scheduler.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>TypeError</code>
          </td>
          <td><p>If the decorated object is not a Callable.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tawazi/decorators.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="k">def</span> <span class="nf">dag</span><span class="p">(</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">declare_dag_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVDAG</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="o">*</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">max_concurrency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">behavior</span><span class="p">:</span> <span class="n">ErrorStrategy</span> <span class="o">=</span> <span class="n">ErrorStrategy</span><span class="o">.</span><span class="n">strict</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVDAG</span><span class="p">]],</span> <span class="n">DAG</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVDAG</span><span class="p">]],</span> <span class="n">DAG</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVDAG</span><span class="p">]]:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform the declared `ExecNode`s into a DAG that can be executed by Tawazi&#39;s scheduler.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    The same DAG can be executed multiple times.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    Note: dag is thread safe because it uses an internal lock.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        If you need to construct lots of DAGs in multiple threads,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        it is best to construct your dag once and then use it as much as you like.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Please check the example in the README for a guide to the usage.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        declare_dag_function: a function that describes the execution of the DAG.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">            This function should only contain calls to `ExecNode`s and data Exchange between them.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            (i.e. You can not use a normal Python function inside it unless decorated with `@xn`.)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">            However, you can use some simple python code to generate constants.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">            These constants are computed only once during the `DAG` declaration.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        max_concurrency: the maximum number of concurrent threads to execute in parallel.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        behavior: the behavior of the `DAG` when an error occurs during the execution of a function (`ExecNode`).</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        a `DAG` instance that can be used just like a normal Python function. However it will be executed by Tawazi&#39;s scheduler.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        TypeError: If the decorated object is not a Callable.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># wrapper used to support parametrized and non parametrized decorators</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">def</span> <span class="nf">intermediate_wrapper</span><span class="p">(</span><span class="n">_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVDAG</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DAG</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVDAG</span><span class="p">]:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="c1"># 0. Protect against multiple threads declaring many DAGs at the same time</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">with</span> <span class="n">exec_nodes_lock</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="c1"># 1. node.exec_nodes contains all the ExecNodes that concern the DAG being built at the moment.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="c1">#      make sure it is empty</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">node</span><span class="o">.</span><span class="n">exec_nodes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="c1"># 2. make ExecNodes corresponding to the arguments of the ExecNode</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="c1"># 2.1 get the names of the arguments and the default values</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="n">func_args</span><span class="p">,</span> <span class="n">func_default_args</span> <span class="o">=</span> <span class="n">get_args_and_default_args</span><span class="p">(</span><span class="n">_func</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="c1"># 2.2 Construct non default arguments.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="c1"># Corresponding values must be provided during usage</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecNode</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ArgExecNode</span><span class="p">(</span><span class="n">_func</span><span class="p">,</span> <span class="n">arg_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="n">func_args</span><span class="p">]</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="c1"># 2.2 Construct Default arguments.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                    <span class="p">[</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                        <span class="n">ArgExecNode</span><span class="p">(</span><span class="n">_func</span><span class="p">,</span> <span class="n">arg_name</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                        <span class="k">for</span> <span class="n">arg_name</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">func_default_args</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="p">]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="c1"># 2.3 Arguments are also ExecNodes that get executed inside the scheduler</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="n">node</span><span class="o">.</span><span class="n">exec_nodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="c1"># 3. Execute the dependency describer function</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="c1"># NOTE: Only ordered parameters are supported at the moment!</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="c1">#  No **kwargs!! Only positional Arguments</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="n">returned_exec_nodes</span> <span class="o">=</span> <span class="n">_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="c1"># 4. Construct the DAG instance</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">d</span><span class="p">:</span> <span class="n">DAG</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">RVDAG</span><span class="p">]</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                    <span class="n">node</span><span class="o">.</span><span class="n">exec_nodes</span><span class="p">,</span> <span class="n">max_concurrency</span><span class="o">=</span><span class="n">max_concurrency</span><span class="p">,</span> <span class="n">behavior</span><span class="o">=</span><span class="n">behavior</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="c1"># clean up even in case an error is raised during dag construction</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="c1"># 5. Clean global variable</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="c1"># node.exec_nodes are deep copied inside the DAG.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="c1">#   we can empty the global variable node.exec_nodes</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="n">node</span><span class="o">.</span><span class="n">exec_nodes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">d</span><span class="o">.</span><span class="n">input_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="c1"># 6. make the return ids to be fetched at the end of the computation</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="n">d</span><span class="o">.</span><span class="n">return_ids</span> <span class="o">=</span> <span class="n">get_return_ids</span><span class="p">(</span><span class="n">returned_exec_nodes</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">_func</span><span class="p">)</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="n">d</span><span class="o">.</span><span class="n">_validate</span><span class="p">()</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="k">return</span> <span class="n">d</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="c1"># case 1: arguments are provided to the decorator</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">if</span> <span class="n">declare_dag_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="c1"># return a decorator</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="k">return</span> <span class="n">intermediate_wrapper</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="c1"># case 2: arguments aren&#39;t provided to the decorator</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">declare_dag_function</span><span class="p">):</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">declare_dag_function</span><span class="si">}</span><span class="s2"> is not a callable. Did you use a non-keyword argument?&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="k">return</span> <span class="n">intermediate_wrapper</span><span class="p">(</span><span class="n">declare_dag_function</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6df46069.min.js"></script>
      
    
  </body>
</html>